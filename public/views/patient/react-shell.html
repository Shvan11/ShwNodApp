<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Portal</title>

    <!-- Existing CSS -->
    <link rel="stylesheet" href="../../css/main.css" />
    <link rel="stylesheet" href="../../css/layouts/navigation.css" />
    <link rel="stylesheet" href="../../css/pages/grid.css" />
    <link rel="stylesheet" href="../../css/pages/payments.css" />
    <link rel="stylesheet" href="../../css/pages/xrays.css" />
    <link rel="stylesheet" href="../../css/pages/visits-summary.css" />
    <link rel="stylesheet" href="../../css/pages/canvas.css" />
    <link rel="stylesheet" href="../../photoswipe/dist/photoswipe.css" />

    <!-- React CDN -->
    <!-- <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script> -->
    <!-- <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script> -->
    <script crossorigin src="../../js/vendor/react.production.min.js"></script>
    <script crossorigin src="../../js/vendor/react-dom.production.min.js"></script>

    <style>
        /* React shell specific styles */
        #react-root {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #patient-shell {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .navigation-header {
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            background: var(--gradient-accent);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .content-area {
            flex: 1;
            overflow: hidden;
            position: relative;
            min-height: 0;
            /* Important for flex child */
        }

        .content-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            display: block;
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 18px;
            color: var(--text-color);
        }

        .loading-spinner::after {
            content: "";
            width: 20px;
            height: 20px;
            margin-left: 10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .error-message {
            padding: 20px;
            text-align: center;
            color: #e74c3c;
            font-size: 16px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- React will mount here -->
    <div id="react-root"></div>

    <!-- React Components - Imported in correct order -->
    <script src="../../js/components/react/Navigation.js"></script>
    <script src="../../js/components/react/GridComponent.js"></script>
    <script src="../../js/components/react/PaymentsComponent.js"></script>
    <script src="../../js/components/react/XraysComponent.js"></script>
    <script src="../../js/components/react/VisitsComponent.js"></script>
    <script src="../../js/components/react/CompareComponent.js"></script>
    <script src="../../js/components/react/ContentRenderer.js"></script>
    <script src="../../js/components/react/PatientShell.js"></script>
    <script src="../../js/components/react/App.js"></script>

    <!-- Initialize React App -->
    <script>
        console.log('üöÄ Initializing React Patient Portal...');

        // Verify all components are loaded
        const requiredComponents = [
            'Navigation', 'GridComponent', 'PaymentsComponent',
            'XraysComponent', 'VisitsComponent', 'CompareComponent',
            'ContentRenderer', 'PatientShell', 'App'
        ];

        const missingComponents = requiredComponents.filter(name => !window[name]);

        if (missingComponents.length > 0) {
            console.error('‚ùå Missing components:', missingComponents);
            document.getElementById('react-root').innerHTML = `
                <div style="padding: 20px; text-align: center; color: red;">
                    <h2>Error: Missing Components</h2>
                    <p>The following components failed to load: ${missingComponents.join(', ')}</p>
                    <p>Please check the console for more details.</p>
                </div>
            `;
        } else {
            console.log('‚úÖ All components loaded successfully');

            // Mount React App
            const root = ReactDOM.createRoot(document.getElementById('react-root'));
            root.render(React.createElement(window.App));

            console.log('‚úÖ React Patient Portal initialized successfully');
        }
    </script>
</body>

</html>